---
title: "Tables"
output:
  html_document:
    toc: true
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Introduction

Tables are essential for presenting the study population and the distribution of important covariates. The tablR function in the cancR package is useful for this task.\
\
First we load the cancR package

```{r, message = FALSE, warning = FALSE}
library(cancR)
```

## Tables with only on group

We use our `redcap_df` as an example. Let us create a simple table of the whole population and present the covariates age, sex and tumor type

```{r, results = "asis"}
tablR(redcap_df,
      vars = c(age, sex, type))
```

We instantly conclude that sex and type is incorrectly formatted, as we wish to see percentages and not a median as if the 0/1 structure was numeric. We convert the variables using `factR()` and pipe into the `tablR()`. Notice that when we pipe we do not need to specify the data frame in `tablR()`

```{r, results = "asis"}
redcap_df %>% 
  factR(c(sex, type)) %>% 
  tablR(vars = c(age, sex, type))
```

## Tables with multiple groups

If we want to compare multiple groups, we use the `group` argument. Let us compare tumor types

```{r, results = "asis"}
redcap_df %>% 
  factR(c(sex, type)) %>% 
  tablR(group = type,
        vars = c(age, sex))
```

We can also add a `total`column and also test the differences in distributions

```{r, results = "asis"}
redcap_df %>% 
  factR(c(sex, type),
        levels = list("type" = c("0", "1", "2"))) %>% 
  tablR(group = type,
        vars = c(age, sex),
        test = TRUE,
        total = TRUE)
```

## Customizing tables

Most of the content of the table can be customized in `tablR()`

### Changing labels

It is possible to rename three types of labels:\
- Group names: `labs.groups`
- Variable names: `labs.headings`
- Variable labels/levels: `labs.subheadings`


```{r}
redcap_df %>%
  factR(c(type, sex)) %>%
  tablR(
    group = type,
    vars=c(age, sex),
    labs.groups = list("benign" = "0",
                                     "in situ" = "1",
                                     "malignant" = "2"),
    labs.headings = list("Age at Debut" = "age"),
    labs.subheadings = list("sex" = list("Female" = "2",
                                         "Male" = "1")))
```

### Changing orders

The order of the groups and variable levels can be specified with the `reference()` and `levels()` arguments

```{r}
redcap_df %>%
  factR(c(type, sex, localisation)) %>%
  tablR(
    group = type,
    vars=c(age, sex, localisation),
    labs.groups = list("benign" = "0",
                                     "in situ" = "1",
                                     "malignant" = "2"),
    labs.headings = list("Age at Debut" = "age"),
    labs.subheadings = list("sex" = list("Female" = "2",
                                         "Male" = "1"),
                            "localisation" = list("Neck" = "0",
                                                  "Head" = "1",
                                                  "Trunk" = "2",
                                                  "Upper Extremity" = "3",
                                                  "Lower Extremity" = "4",
                                                  "Unspecified" = "5")),
    reference = list("sex" = c("Female")))
```

### Changing summary measures

The default summary measures for continuous variables are median, interquartile range and range. This can be specified in the `numeric()` argument

```{r}
redcap_df %>%
  factR(c(type, sex, localisation)) %>%
  tablR(
    group = type,
    vars=c(age, sex, localisation),
    labs.groups = list("benign" = "0",
                                     "in situ" = "1",
                                     "malignant" = "2"),
    labs.headings = list("Age at Debut" = "age"),
    labs.subheadings = list("sex" = list("Female" = "2",
                                         "Male" = "1"),
                            "localisation" = list("Neck" = "0",
                                                  "Head" = "1",
                                                  "Trunk" = "2",
                                                  "Upper Extremity" = "3",
                                                  "Lower Extremity" = "4",
                                                  "Unspecified" = "5")),
    reference = list("sex" = c("Female")),
    numeric = c("mean", "sd"))
```
 
 ### Customizing tables
 
 All levels and labels can be set manually. Furthermore, the table can be exported as a flextable object for nicer layout. For this example we also collapse variables of similar kind for simplicity with the `simplify` argument. This is preferred in a lot of variables with yes/no, 1/0, positive/negative syntax.
 
```{r}
# redcap_df %>%
#   mutate(margins = sample(c("0","1"), nrow(redcap_df), replace=TRUE)) %>%
#   factR(c(type, sex, localisation, cd10, sox10, ck, margins, necrosis)) %>%
#   tablR(group=type,
#          vars = c(age, sex, localisation, cd10, sox10, ck, necrosis, margins),
#     labs.groups = list("benign" = "0",
#                                      "in situ" = "1",
#                                      "malignant" = "2"),
#          reverse = T,
#          labs.headings = list("Age at Debut" = "age",
#                               "Gender" = "sex",
#                               "CD10" = "cd10"),
#          labs.subheadings = list("sex" = list("Female" = "2",
#                                               "Male" = "1"),
#                                  "localisation" = list("Neck" = "0",
#                                                        "Head" = "1",
#                                                        "Trunk" = "2",
#                                                        "Upper Extremity" = "3",
#                                                        "Lower Extremity" = "4",
#                                                        "Unspecified" = "5")),
#          reference = list("sex" = c("Male")),
#          simplify=list("Immunohistochemistry" = c("cd10", "sox10", "ck"),
#                        "Tumor" = c("necrosis", "margins")),
#          censur=T,
#          numeric = c("mean", "sd", "q1q3", "iqr"),
#          test=T,
#          total=T)
```
 
